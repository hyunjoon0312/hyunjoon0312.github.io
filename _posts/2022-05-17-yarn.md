---
title:  "[HADOOP #2] YARN이란 무엇인가?"
excerpt: "Hadoop을 구성하고 있는 서비스 중 작업들의 Task를 관리 및 스케쥴링 하고 각각의 작업에 자원을 적절히 분배하여 관리해주는 기능을 수행하는 서비스인 Yarn에 대한 설명"
toc: true
toc_sticky: true
toc_label: "목차"

categories:
  - hadoop
tags:
  - Hadoop

---

Hadoop 시리즈 두번째 포스팅으로 지난 HDFS란 무엇인가에 이어서 이번 포스팅에서는 YARN이란 무엇인가에 대해 이야기해보려고 합니다. 지난 포스팅을 아직 확인하지 않으셨다면 아래 링크로 확인 부탁드리겠습니다.



- [하둡 에코 시스템(Hadoop Eco System)이란?](https://onestep-log.com/hadoop/hadoop-eco/)
- [[HADOOP #1\] HDFS란 무엇인가?](https://onestep-log.com/hadoop/hdfs/)



10여년의 시간을 거쳐 현재 3버전까지 릴리즈가 된 Apache Hadoop에게 YARN은 원래 있던 서비스인듯 하지만, 사실 처음 Hadoop이 세상에 나왔던 1버전에서는 YARN 없이 HDFS와 MapReduce만 있었습니다. 별도의 자원 관리 서비스가 없었기 때문에 MapReduce가 작업을 처리함과 동시에 MapReduce의 Job Tracker가 자원의 관리의 역할도 수행 하였습니다. 그러나 점차 데이터 양이 많아지고 처리해야 하는 테스크(Task)가 커지면서 MapReduce가 작업 처리와 함께 자원 관리까지 하기에는 부하가 발생하며 병목지점이 되었습니다. 그리고 이러한 문제를 해결하기 위해 Hadoop 2 버전부터 추가된 서비스가 바로 **자원 관리와 작업 스케쥴링을 담당**하는 YARN 입니다.



## YARN이란?

Yet Another Resource Negotiator의 약자로 우리말로 직역을 해보자면 ” 또 다른 자원 협상가 ” 입니다. 실제로 맡고 있는 역할과 딱 맞는 이름이죠. YARN은 수십, 수백 개의 노드로 구성된 Hadoop 클러스터에서 실행되는 **수 많은 작업 Task들을 관리 및 스케쥴링하고 각각의 작업에 사용될 자원을 적절히 분산하여 관리해주는 기능을 수행**합니다. 여기서 말하는 자원은 Hadoop 클러스터의 모든 장비들의 CPU 코어 수와 Memory 크기를 합친 클러스터의 총 CPU 코어와 총 Memory 크기 입니다. 



## YARN의 구성

YARN은 ResourceManager, NodeManager, Timeline Server와 같은 장기 실행 데몬으로 구성되어 있으며, 각각의 기능은 다음과 같습니다.



### **ResourceManager**

- Master 역할을 하는 서비스로, 전체 클러스터에서 하나 또는 HA 구성을 하였을 경우에는 Active – Standby 구조로 단 두 개의 노드에서만 실행됩니다. 그리고 ResourceManager는 Scheduler와ApplicationsManager라는 두가지 주요 컴포넌트를 가지고 있습니다.
- Scheduler는 용량(capacity)과 큐(queue)를 설정된 스케쥴링 정책에 기반하여 실행 중인 다양한 애플리케이션(Application)에 자원을 할당하는 역할을 합니다. Scheduler는 애플리케이션의 상태를 모니터링하거나 추적하지 않으며 실패한 작업을 다시 시작시키지도 않습니다. 단지 애플리케이션에 필요한 자원 요청에 따라 CPU, 메모리와 같은 자원을 컨테이너 기반으로 할당하는 역할만 합니다.
- 

- ApplicationsManager는 애플리케이션 제출을 수락하고 애플리케이션 별 ApplicationMaster를 실행하기 위한 첫번째 컨테이너를 협상하며, 실패시 ApplicationMaster 컨테이너를 재시작하는 서비스를 제공합니다. 애플리케이션별 ApplicationMaster는 Schdeuler와 적절한 자원의 컨테이너를 협상하며 상태를 추적하고 진행 상황의 모니터링을 수행 합니다.

 

### **NodeManager**

- Worker 역할을 하는 서비스로 ResourceManger가 실행되는 노드 이외의 노드에서 실행됩니다. 일반적으로는 Datanode가 실행되고 있는 노드와 동일한 노드에서 실행됩니다.
- ResourceManager에게 주기적인 Heartbeat를 전달하여 상태 정보를 전달합니다. 
- ResourceManager에게 할당 받은 컨테이너의 자원 사용량을 감시하고 컨테이너에 할당된 자원보다 많이 사용하게 될 경우 ResourceManager으로부터 해당 컨테이너를 종료시키라는 명령을 받아 수행합니다.

 

### **Timeline Server**

- 애플리케이션이나 MapReduce와 같은 프레임워크의 정보를 수집하고 검색합니다. MapReduce의 경우 Map 작업 수, Reduce 작업 수, 카운터 등의 정보가 해당 됩니다.
-  Queue-name, 사용자 정보, 컨테이너 정보 등에 대한 데이터를 유지합니다.



## YARN 구동 방식

![img](https://drive.google.com/uc?export=view&id=1XkMCu9yCPU-1m2ZHWBz9xhcA7QVZzH5q)

① : 클라이언트는 애플리케이션을 실행하기 위해서 ResourceManager에게 ApplicationMaster 프로세스의 실행을 요청합니다.

② : ResourceManager는 컨테이너에서 ApplicationMaster를 실행시킬 수 있는 NodeManager를 찾습니다.

③ : NodeManager에서 컨테이너 생성 후 ApplicationMaster를 실행합니다.

④ : 분산 처리를 수행하기 위해 ResourceManager에게 더 많은 컨테이너를 요청 합니다.

⑤ : 분산 처리를 수행할 수 있는 다른 NodeManager에게 컨테이너 생성을 요청합니다.

⑥ : 컨테이너를 생성하여 분산 처리를 수행합니다.



## YARN Scheduler 정책

가장 이상적인 것은 모든 애플리케이션 요청이 즉시 실행 및 처리 되는 것이지만 실제로 가용할 수 있는 자원보다 훨씬 많은 애플리케이션 요청이 클러스터에 들어오기 때문에 이것은 불가능 합니다. 따라서 정해 놓은 기준에 따라 애플리케이션 요청을 처리하게 되는데 그것이 Scheduler 정책입니다. YARN Scheduler 정책에는 FIFO, Capacity, Fair Scheduler 등이 있습니다.



- FIFO Scheduler : FIFO는 선입선출(First In, First Out)방식으로 애플리케이션을 큐에 하나씩 넣고 들어온 순서에 따라 순차적으로 실행하는 방식입니다. FIFO 방식은 명확한 기준으로 복잡한 계산이나 설정이 필요 없다는 장점이 있지만, 하나의 큰 애플리케이션이 실행되면 클러스터의 모든 자원을 사용하여, 이 애플리케이션이 끝날 때까지 다른 애플리케이션은 실행되지 못하게 한다는 단점이 있습니다. 따라서 동시에 여러 개의 애플리케이션이 실행되는 Hadoop 클러스터 환경에 적절한 Scheduler 정책은 아닙니다.

- Capacity Scheduler : Capacity Scheduler는 미리 큐 별로 자원을 할당해두어 각각의 큐가 다른 큐에게 할당된 자원을 사용하지 못하게 하는 방식입니다. 따라서 다른 큐의 애플리케이션과는 무관하게 실행시키고자 하는 애플리케이션 큐가 비어 있다면 즉시 처리가 가능합니다. 각각의 큐는 FIFO Scheduler 방식으로 처리되는 것과 동일하며, 단점으로는 미리 자원을 분배해 놓기 때문에 전체 클러스터의 자원 사용 효율이 떨어집니다. 

- Fair Scheduler : Faire Scheduler는 실행 중인 모든 애플리케이션에 동일하게 자원을 할당합니다.
  **큐 설정이 안되어 있는 상황**에서 만약 처음 A라는 애플리케이션이 요청되면 전체 자원이 A 하나에 모두 할당되며 이후 중간에 B라는 애플리케이션이 추가로 요청되면 A에 요청되었던 자원의 반을 B에 할당해줍니다. 그리고 B의 애플리케이션이 먼저 완료될 경우 반납 된 자원을 다시 A에 할당해줍니다. 
  **큐 A와 큐 B가 50:50으로 설정되어 있는 상황**에서는 처음 A라는 애플리케이션이 큐 A에 요청되면 큐 B에는 요청된 애플리케이션이 없기 때문에 큐와 무관하게 모든 자원이 A 애플리케이션을 수행하는데 사용됩니다. 그리고 얼마 뒤 큐 B에도 B라는 애플리케이션이 요청되면 A 애플리케이션에 할당되었던 자원을 회수하여 B 애플리케이션에게 할당합니다. 이후 큐 B에 추가로 C 애플리케이션이 요청되면 B 애플리케이션에게 할당된 자원의 또 반을 회수하여 C 애플리케이션에게 할당하게 됩니다.



## 마치며

여기까지 Apache Hadoop YARN에 대해서 알아보았습니다. 모든 부분을 다루지는 못하였지만 핵심 개념적인 부분은 이 정도의 내용이면 개인적으로 충분하지 않은가 생각됩니다. 좀 더 많은 내용이 궁금하시다면 아래 참고에 Apache Hadoop 공식 홈페이지에서 YARN에 대한 내용을 살펴보시는 것도 큰 도움이 되실 것 같습니다. 다음 포스팅에서는 Apache Hadoop 설치에 대해 다루도록 하겠습니다.



## 참고

- [Apache Hadoop 공식 홈페이지](https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html)
- OREILLY Hadoop The Definitive Guide 4판